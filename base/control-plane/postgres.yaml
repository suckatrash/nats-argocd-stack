apiVersion: sql.gcp.upbound.io/v1beta1
kind: DatabaseInstance
metadata:
  name: control-plane-db
  namespace: control-plane
  annotations:
    argocd.argoproj.io/sync-wave: "1"
spec:
  forProvider:
    region: us-west1
    databaseVersion: POSTGRES_16
    settings:
      - edition: ENTERPRISE
        tier: db-f1-micro
        diskSize: 10
        diskType: PD_SSD
        ipConfiguration:
          - ipv4Enabled: false
            privateNetwork: projects/PROJECT_ID_PLACEHOLDER/global/networks/default
            requireSsl: true
        backupConfiguration:
          - enabled: true
            startTime: "03:00"
            pointInTimeRecoveryEnabled: true
  deletionPolicy: Orphan
  writeConnectionSecretToRef:
    name: control-plane-db-connection
    namespace: control-plane
  providerConfigRef:
    name: default
---
apiVersion: sql.gcp.upbound.io/v1beta1
kind: Database
metadata:
  name: control-plane-scpdata
  namespace: control-plane
  annotations:
    argocd.argoproj.io/sync-wave: "2"
    argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
spec:
  forProvider:
    instanceRef:
      name: control-plane-db
  deletionPolicy: Orphan
  providerConfigRef:
    name: default
---
apiVersion: sql.gcp.upbound.io/v1beta1
kind: User
metadata:
  name: control-plane-scp-user
  namespace: control-plane
  annotations:
    argocd.argoproj.io/sync-wave: "2"
    argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
spec:
  forProvider:
    instanceRef:
      name: control-plane-db
    passwordSecretRef:
      name: control-plane-db-password
      namespace: control-plane
      key: password
  providerConfigRef:
    name: default
