# Crossplane Provider Configurations
# Configure authentication for cloud providers

---
# AWS Provider Config using IRSA (recommended for EKS)
apiVersion: aws.upbound.io/v1beta1
kind: ProviderConfig
metadata:
  name: default
spec:
  credentials:
    source: InjectedIdentity  # Uses IRSA / IAM Roles for Service Accounts

---
# AWS Provider Config using Secret (alternative)
apiVersion: aws.upbound.io/v1beta1
kind: ProviderConfig
metadata:
  name: aws-credentials
spec:
  credentials:
    source: Secret
    secretRef:
      namespace: crossplane-system
      name: aws-credentials
      key: credentials

---
# GCP Provider Config using Workload Identity (recommended for GKE)
apiVersion: gcp.upbound.io/v1beta1
kind: ProviderConfig
metadata:
  name: default
spec:
  projectID: your-gcp-project-id
  credentials:
    source: InjectedIdentity

---
# GCP Provider Config using Secret (alternative)
apiVersion: gcp.upbound.io/v1beta1
kind: ProviderConfig
metadata:
  name: gcp-credentials
spec:
  projectID: your-gcp-project-id
  credentials:
    source: Secret
    secretRef:
      namespace: crossplane-system
      name: gcp-credentials
      key: credentials.json

---
# Azure Provider Config using Managed Identity (recommended for AKS)
apiVersion: azure.upbound.io/v1beta1
kind: ProviderConfig
metadata:
  name: default
spec:
  credentials:
    source: InjectedIdentity

---
# Azure Provider Config using Secret (alternative)
apiVersion: azure.upbound.io/v1beta1
kind: ProviderConfig
metadata:
  name: azure-credentials
spec:
  credentials:
    source: Secret
    secretRef:
      namespace: crossplane-system
      name: azure-credentials
      key: credentials

---
# Kubernetes Provider Config (for in-cluster operations)
apiVersion: kubernetes.crossplane.io/v1alpha1
kind: ProviderConfig
metadata:
  name: kubernetes-provider
spec:
  credentials:
    source: InjectedIdentity

---
# Service Account for AWS Provider (using IRSA)
apiVersion: v1
kind: ServiceAccount
metadata:
  name: provider-aws
  namespace: crossplane-system
  annotations:
    eks.amazonaws.com/role-arn: arn:aws:iam::ACCOUNT_ID:role/crossplane-provider-aws

---
# Example: AWS Credentials Secret (if not using IRSA)
# DO NOT commit real credentials - use External Secrets Operator
apiVersion: v1
kind: Secret
metadata:
  name: aws-credentials
  namespace: crossplane-system
type: Opaque
stringData:
  credentials: |
    [default]
    aws_access_key_id = YOUR_ACCESS_KEY
    aws_secret_access_key = YOUR_SECRET_KEY

---
# Example: Using External Secrets to create provider credentials
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: crossplane-aws-credentials
  namespace: crossplane-system
spec:
  refreshInterval: 1h
  
  secretStoreRef:
    name: aws-secretsmanager-cluster
    kind: ClusterSecretStore
  
  target:
    name: aws-credentials
    creationPolicy: Owner
    template:
      data:
        credentials: |
          [default]
          aws_access_key_id = {{ .access_key_id }}
          aws_secret_access_key = {{ .secret_access_key }}
  
  data:
  - secretKey: access_key_id
    remoteRef:
      key: crossplane/aws-credentials
      property: access_key_id
  
  - secretKey: secret_access_key
    remoteRef:
      key: crossplane/aws-credentials
      property: secret_access_key
